基于比特币实现的去中心化的德州扑克实现内幕
==========================================================

要实现完全的去中心化和公平, 必须依靠bitcoin中的交易, 交易一旦上链就无法更改, 并且可以供所有人随时查看

首先, 游戏中玩家的每一步操作都对应一笔交易, 一局完整的游戏对应着一系列的交易, 通过回溯这些交易的内容,
可以得到游戏结果, 验证玩家有没有作弊


由于bitcoin交易的限制, 我们对交易进行了扩展以便符合我们游戏的逻辑
主要有以下三方面:

1. 游戏业务数据和bitcoin交易的分离
---------------------------------

简单来说就是, 游戏数据存储在ipfs上, 交易中只写入ipfs对应的hash值
 
由于bitcoin对交易以及区块大小的限制, 我们不可能把游戏数据直接写在交易中,一方面交易的体积会很大, 同时解析交易也会变得繁琐
为此我们将游戏中玩家的每一步操作数据都存储在ipfs文件中, 而在交易的 OP_RETURN 中只保存ipfs文件对应的hash值

这样做可以统一交易的格式, 减小交易的大小, 当然, 要想解析这笔交易对应的数据, 只需要取出hash值去ipfs上找到对应的数据即可,
通过回溯这些数据就可以计算出游戏结果

2. 脚本的扩展
---------------------------------

bitcoin中花费一笔交易是通过验证交易输出的锁定脚本, 然而, 在游戏未结束之前, 我们是无从得知谁会是最后的赢家, 
就无法在交易的输出中提前写入赢家的地址, 为此我们针对游戏添加了脚本的操作码 OP_POKER

前面已经提到, 玩家的每次操作都会构建一笔对应的交易, 需要注意的是, 玩家的下注交易和其它交易有些不同,
下注交易在构建时会在输出脚本中放入 OP_POKER 操作码, 当游戏结束时, 赢家会创建一笔交易, 把所有下注交易的钱都打入自己的地址,
这笔交易的输入就是这些带 OP_POKER 的下注交易, 输出就是自己的地址

当有人尝试去签名这笔交易时, 通过回溯历史交易中保存的游戏数据, 可以判断出你是不是真正的赢家, 也就是说
只有赢家才能解锁 OP_POKER 操作码, 从而花费交易里面的钱.
当然, 这笔交易广播到bitcoin网络中, 其它节点也会去验证它的合法性, 最后通过矿工上链

3. 洗牌
---------------------------------

因为没有中心化的服务器, 洗牌只能由参与游戏的玩家共同完成, 同时要保证没有人能作弊, 牌面值不会暴露

这部分我们使用的是基于零知识证明实现的第三方库libTMCG, 由密码学来保证手牌的隐私, 不到最后开牌阶段, 你的手牌不会公开.


综上所述, 为实现游戏的公平, 主要对洗牌和下注做了优化, 零知识证明洗牌保证了扑克牌的安全, 
bitcoin交易记录了游戏的过程, 任何人都可以查看和验证游戏结果, 保证了游戏的公平公开
